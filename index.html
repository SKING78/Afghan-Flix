<!DOCTYPE html>
<html lang="ps" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Afghan Flix</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a148c;
            --secondary-color: #7b1fa2;
            --accent-color: #e91e63;
            --danger-color: #f44336;
            --dark-color: #1a237e;
            --light-color: #f3e5f5;
            --text-color: #212121;
            --text-light: #757575;
            --white: #ffffff;
            --black: #000000;
            --shadow: 0 2px 5px rgba(0,0,0,0.1);
            --gradient: linear-gradient(135deg, #4a148c 0%, #e91e63 100%);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        body.dark-mode {
            background-color: var(--black);
            color: var(--white);
            --light-color: #121212;
            --white: #1e1e1e;
            --text-color: #f5f5f5;
        }

        /* نويټیشن بار */
        .nav-container {
            background: var(--gradient);
            color: var(--white);
            padding: 15px;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 100;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-weight: bold;
            font-size: 20px;
            font-family: 'Arial', sans-serif;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
        }

        .logo-icon {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            background: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .nav-icons {
            display: flex;
            gap: 15px;
        }

        .nav-icons i {
            font-size: 20px;
            cursor: pointer;
        }

        /* اصلی کونټینر */
        .main-container {
            margin-top: 60px;
            padding-bottom: 60px;
        }

        /* ویډیو پلیئر */
        .video-container {
            position: relative;
            width: 100%;
            background-color: #000;
        }

        #custom-video-player {
            width: 100%;
            height: 360px;
            background-color: #000;
        }

        .custom-controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: var(--white);
            padding: 10px;
            border-top: 1px solid #eee;
        }

        #quality-select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid var(--primary-color);
            background-color: var(--white);
            color: var(--primary-color);
        }

        #volume-control {
            width: 100px;
        }

        /* ویډیو کنټرولونه */
        .video-controls {
            background-color: var(--white);
            padding: 10px 15px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid #eee;
        }

        .control-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 5px;
            min-width: 60px;
        }

        .control-btn i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .control-btn.active {
            color: var(--accent-color);
        }

        /* ویډیو معلومات */
        .video-info {
            padding: 15px;
            background-color: var(--white);
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .video-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--dark-color);
        }

        .video-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-light);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .video-desc {
            font-size: 14px;
            color: var(--text-color);
        }

        /* اړونده ویډیوګانې */
        .related-videos {
            padding: 15px;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--dark-color);
        }

        .video-item {
            display: flex;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .video-item:hover {
            background-color: var(--light-color);
        }

        .video-thumb {
            width: 120px;
            height: 70px;
            background-color: #eee;
            margin-left: 10px;
            flex-shrink: 0;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .video-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-thumb .duration {
            position: absolute;
            bottom: 5px;
            left: 5px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
        }

        /* تب بار */
        .tab-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: var(--white);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .tab-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-light);
            text-decoration: none;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .tab-btn i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .tab-btn.active {
            color: var(--primary-color);
            transform: translateY(-5px);
        }

        /* لودر */
        .loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .loader-content {
            background-color: var(--white);
            padding: 20px;
            border-radius: 5px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        /* د پاڼو سټایل */
        .page {
            display: none;
            padding: 15px;
        }

        .page.active {
            display: block;
        }

        /* اپلوډ فورم */
        .upload-form {
            background-color: var(--white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--dark-color);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: var(--light-color);
        }

        .upload-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
        }

        /* د ننوتلو فورم */
        .auth-form {
            max-width: 400px;
            margin: 30px auto;
            background-color: var(--white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .auth-title {
            text-align: center;
            margin-bottom: 20px;
            color: var(--dark-color);
        }

        .auth-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
        }

        .auth-link {
            text-align: center;
            margin-top: 15px;
            color: var(--primary-color);
        }

        /* د آر ډارک موډ تڼۍ */
        .theme-toggle {
            position: fixed;
            bottom: 70px;
            right: 20px;
            background: var(--gradient);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 99;
        }

        /* د ویډیو اپلوډ حالت */
        .upload-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        .upload-success {
            background-color: #d4edda;
            color: #155724;
        }

        .upload-error {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* سرچ بار */
        .search-bar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 100%;
            background-color: var(--white);
            padding: 10px 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 99;
            display: none;
        }

        .search-bar input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
        }

        /* اډمین کنټرولونه */
        .admin-controls {
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        .admin-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            margin: 5px;
            cursor: pointer;
        }

        /* د ژبې انتخاب */
        .language-selector {
            position: fixed;
            top: 60px;
            right: 10px;
            z-index: 100;
        }

        .language-selector select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid var(--primary-color);
            background-color: var(--white);
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <!-- نويټیشن بار -->
    <div class="nav-container">
        <div class="logo">
            <div class="logo-icon">AF</div>
            <span data-lang-key="app_title">Afghan Flix</span>
        </div>
        <div class="nav-icons">
            <i class="fas fa-search" onclick="toggleSearch()"></i>
            <i class="fas fa-user-circle" onclick="showPage('profile-page')"></i>
            <i class="fas fa-upload" onclick="showPage('upload-page')"></i>
        </div>
    </div>

    <!-- د ژبې انتخاب -->
    <div class="language-selector">
        <select id="languageSelect" onchange="changeLanguage()">
            <option value="ps">پښتو</option>
            <option value="fa">دري</option>
            <option value="en">English</option>
        </select>
    </div>

    <!-- سرچ بار -->
    <div class="search-bar" id="searchBar">
        <input type="text" id="searchInput" data-lang-key="search_placeholder">
    </div>

    <!-- اصلی کونټینر -->
    <div class="main-container">
        <!-- کور پاڼه -->
        <div class="page active" id="home-page">
            <!-- ویډیو پلیئر -->
            <div class="video-container">
                <video id="custom-video-player" controls>
                    <source id="video-source" src="https://archive.org/download/afghan-flix-videos/pashto-song.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div class="custom-controls">
                    <button id="skip-backward" class="control-btn"><i class="fas fa-backward"></i> <span data-lang-key="skip_backward">10 ثانیې شاته</span></button>
                    <button id="skip-forward" class="control-btn"><i class="fas fa-forward"></i> <span data-lang-key="skip_forward">10 ثانیې مخکې</span></button>
                    <select id="quality-select">
                        <option value="low">360p</option>
                        <option value="medium" selected>720p</option>
                        <option value="high">1080p</option>
                    </select>
                    <button id="fullscreen-btn" class="control-btn"><i class="fas fa-expand"></i> <span data-lang-key="fullscreen">بشپړ سکرین</span></button>
                    <input type="range" id="volume-control" min="0" max="1" step="0.1" value="1">
                </div>
            </div>

            <!-- ویډیو کنټرولونه -->
            <div class="video-controls">
                <button class="control-btn" id="likeBtn">
                    <i class="far fa-heart"></i>
                    <span data-lang-key="like">لایک</span>
                </button>
                <button class="control-btn" id="saveBtn">
                    <i class="far fa-bookmark"></i>
                    <span data-lang-key="save">خوندي</span>
                </button>
                <button class="control-btn" id="downloadBtn">
                    <i class="fas fa-download"></i>
                    <span data-lang-key="download">ډاونلوډ</span>
                </button>
                <button class="control-btn" id="shareBtn">
                    <i class="fas fa-share-alt"></i>
                    <span data-lang-key="share">شریکول</span>
                </button>
            </div>

            <!-- ویډیو معلومات -->
            <div class="video-info">
                <div class="video-title" id="video-title">Pashto Song - Da Zra Qarara Rasha</div>
                <div class="video-meta">
                    <span>1.2K <span data-lang-key="views">لیدنې</span></span>
                    <span data-lang-key="days_ago">2 ورځې وړاندې</span>
                </div>
                <div class="video-desc" id="video-desc" data-lang-key="video_desc">د پښتو یوه ښکلې سندره چې د زړه غږ دی.</div>
            </div>

            <!-- اړونده ویډیوګانې -->
            <div class="related-videos">
                <div class="section-title">
                    <span data-lang-key="related_videos">اړونده ویډیوګانې</span>
                    <a href="#" style="color: var(--primary-color); font-size: 14px;" data-lang-key="see_all">ټولې وګورئ</a>
                </div>

                <div class="video-item" onclick="loadVideo('https://archive.org/download/afghan-flix-videos/pashtun-history-pt2.mp4', 'د پښتنو تاریخ - دوهمه برخه', 'د پښتنو د تاریخ دوهم برخه')">
                    <div class="video-thumb">
                        <img src="https://archive.org/download/afghan-flix-thumbnails/pashtun-history-pt2.jpg" alt="Video Thumbnail">
                        <span class="duration">10:25</span>
                    </div>
                    <div class="video-item-info">
                        <div class="video-item-title">د پښتنو تاریخ - دوهمه برخه</div>
                        <div class="video-item-meta">Afghan Flix • 5.2K لیدنې • 1 اونۍ وړاندې</div>
                    </div>
                </div>

                <div class="video-item" onclick="loadVideo('https://archive.org/download/afghan-flix-videos/pashtun-figures.mp4', 'پښتنو مشهور شخصیتونه', 'د پښتنو مشهور شخصیتونه')">
                    <div class="video-thumb">
                        <img src="https://archive.org/download/afghan-flix-thumbnails/pashtun-figures.jpg" alt="Video Thumbnail">
                        <span class="duration">15:40</span>
                    </div>
                    <div class="video-item-info">
                        <div class="video-item-title">پښتنو مشهور شخصیتونه</div>
                        <div class="video-item-meta">Afghan Flix • 8.7K لیدنې • 2 اونۍ وړاندې</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- اپلوډ پاڼه -->
        <div class="page" id="upload-page">
            <div class="upload-form">
                <h2 style="text-align: center; margin-bottom: 20px; color: var(--dark-color);" data-lang-key="upload_video_title">نوی ویډیو اپلوډ کړئ</h2>

                <div class="form-group">
                    <label for="video-title-input" data-lang-key="video_title_label">د ویډیو عنوان</label>
                    <input type="text" id="video-title-input" data-lang-key="video_title_placeholder">
                </div>

                <div class="form-group">
                    <label for="video-desc-input" data-lang-key="description_label">تفصیل</label>
                    <textarea id="video-desc-input" rows="3" data-lang-key="description_placeholder"></textarea>
                </div>

                <div class="form-group">
                    <label for="video-category" data-lang-key="category_label">کټګوري</label>
                    <select id="video-category">
                        <option value="22" data-lang-key="documentary">مستند</option>
                        <option value="27" data-lang-key="history">تاریخ</option>
                        <option value="25" data-lang-key="culture">کلتور</option>
                        <option value="10" data-lang-key="music">موسیقي</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="video-file" data-lang-key="video_file_label">ویډیو فایل</label>
                    <input type="file" id="video-file" accept="video/*">
                </div>

                <div class="form-group">
                    <label for="video-thumbnail" data-lang-key="thumbnail_label">د ویډیو تصویر</label>
                    <input type="file" id="video-thumbnail" accept="image/*">
                </div>

                <div id="upload-status" class="upload-status"></div>

                <button class="upload-btn" onclick="uploadVideo()">
                    <i class="fas fa-upload"></i> <span data-lang-key="upload">اپلوډ کړئ</span>
                </button>
            </div>
        </div>

        <!-- پروفایل پاڼه -->
        <div class="page" id="profile-page">
            <div class="video-info" style="margin-top: 15px; text-align: center;">
                <div style="width: 100px; height: 100px; border-radius: 50%; background-color: #eee; margin: 0 auto 15px; overflow: hidden;">
                    <img src="https://archive.org/download/afghan-flix-thumbnails/default-profile.jpg" alt="Profile" id="profile-image" style="width: 100%; height: 100%; object-fit: cover;">
                    <input type="file" id="profile-image-input" accept="image/*" style="display: none;" onchange="updateProfileImage()">
                </div>
                <div class="video-title" id="user-name">ستاسو نوم</div>
                <div class="video-desc" id="user-email">کارونکی</div>
            </div>

            <div class="related-videos">
                <div class="section-title" data-lang-key="settings_title">ستاسو تنظیمات</div>

                <div class="video-item" style="padding: 12px 15px;" onclick="toggleDarkMode()">
                    <div class="video-item-info">
                        <div class="video-item-title" data-lang-key="dark_mode">د آر ډارک موډ</div>
                    </div>
                    <i class="fas fa-moon" id="theme-icon" style="color: var(--text-light);"></i>
                </div>

                <div class="video-item" style="padding: 12px 15px;" onclick="changeLanguage()">
                    <div class="video-item-info">
                        <div class="video-item-title" data-lang-key="change_language">ژبه بدلول</div>
                    </div>
                    <i class="fas fa-language" style="color: var(--text-light);"></i>
                </div>

                <div class="video-item" style="padding: 12px 15px;" onclick="manageStorage()">
                    <div class="video-item-info">
                        <div class="video-item-title" data-lang-key="manage_storage">د ذخیرې مدیریت</div>
                    </div>
                    <i class="fas fa-database" style="color: var(--text-light);"></i>
                </div>
            </div>

            <!-- اډمین کنټرولونه -->
            <div id="admin-controls" class="admin-controls" style="display: none;">
                <div class="section-title" data-lang-key="admin_controls_title">اډمین کنټرولونه</div>

                <button class="admin-btn" onclick="showUserManagement()">
                    <i class="fas fa-users-cog"></i> <span data-lang-key="manage_users">د کارونکو مدیریت</span>
                </button>
                <button class="admin-btn" onclick="showVideoManagement()">
                    <i class="fas fa-video"></i> <span data-lang-key="manage_videos">د ویډیوګانو مدیریت</span>
                </button>
                <button class="admin-btn" onclick="showCreateAdmin()">
                    <i class="fas fa-user-shield"></i> <span data-lang-key="create_admin">اډمین جوړول</span>
                </button>
            </div>

            <div class="related-videos" style="margin-top: 20px;">
                <div class="section-title" data-lang-key="other_options">نور اختیارات</div>

                <div class="video-item" style="padding: 12px 15px;" onclick="showHelp()">
                    <div class="video-item-info">
                        <div class="video-item-title" data-lang-key="help">مرسته او پوښتنې</div>
                    </div>
                    <i class="fas fa-question-circle" style="color: var(--text-light);"></i>
                </div>

                <div class="video-item" style="padding: 12px 15px;" onclick="contactUs()">
                    <div class="video-item-info">
                        <div class="video-item-title" data-lang-key="contact_us">زموږ سره اړیکه</div>
                    </div>
                    <i class="fas fa-envelope" style="color: var(--text-light);"></i>
                </div>

                <div class="video-item" style="padding: 12px 15px; color: var(--danger-color);" onclick="logout()">
                    <div class="video-item-info">
                        <div class="video-item-title" data-lang-key="logout">وتل</div>
                    </div>
                    <i class="fas fa-sign-out-alt" style="color: var(--danger-color);"></i>
                </div>
            </div>
        </div>

        <!-- د ننوتلو پاڼه -->
        <div class="page" id="login-page">
            <div class="auth-form">
                <h2 class="auth-title" data-lang-key="login_title">ننوتل</h2>

                <div class="form-group">
                    <label for="login-email" data-lang-key="email_label">برېښنالیک</label>
                    <input type="email" id="login-email" data-lang-key="email_placeholder" required>
                </div>

                <div class="form-group">
                    <label for="login-password" data-lang-key="password_label">پاسورډ</label>
                    <input type="password" id="login-password" data-lang-key="password_placeholder" required>
                </div>

                <button class="auth-btn" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> <span data-lang-key="login">ننوتل</span>
                </button>

                <div class="auth-link" onclick="showPage('register-page')" data-lang-key="create_account_link">
                    نوی حساب جوړول؟
                </div>
            </div>
        </div>

        <!-- د ثبتولو پاڼه -->
        <div class="page" id="register-page">
            <div class="auth-form">
                <h2 class="auth-title" data-lang-key="register_title">نوی حساب جوړول</h2>

                <div class="form-group">
                    <label for="register-name" data-lang-key="name_label">نوم</label>
                    <input type="text" id="register-name" data-lang-key="name_placeholder" required>
                </div>

                <div class="form-group">
                    <label for="register-email" data-lang-key="email_label">برېښنالیک</label>
                    <input type="email" id="register-email" data-lang-key="email_placeholder" required>
                </div>

                <div class="form-group">
                    <label for="register-password" data-lang-key="password_label">پاسورډ</label>
                    <input type="password" id="register-password" data-lang-key="password_placeholder" required>
                </div>

                <div class="form-group">
                    <label for="register-confirm" data-lang-key="confirm_password_label">پاسورډ تایید کړئ</label>
                    <input type="password" id="register-confirm" data-lang-key="confirm_password_placeholder" required>
                </div>

                <button class="auth-btn" onclick="register()">
                    <i class="fas fa-user-plus"></i> <span data-lang-key="register">حساب جوړول</span>
                </button>

                <div class="auth-link" onclick="showPage('login-page')" data-lang-key="already_have_account">
                    دمخه حساب لرئ؟ ننوتل
                </div>
            </div>
        </div>

        <!-- د کارونکو مدیریت پاڼه -->
        <div class="page" id="users-page">
            <div class="related-videos">
                <div class="section-title">
                    <span data-lang-key="manage_users">د کارونکو مدیریت</span>
                    <button class="admin-btn" onclick="showPage('profile-page')">
                        <i class="fas fa-arrow-left"></i> <span data-lang-key="back">بیرته</span>
                    </button>
                </div>

                <div id="users-list">
                    <!-- دلته کارونکی به په JavaScript کې اضافه شي -->
                </div>
            </div>
        </div>

        <!-- د ویډیوګانو مدیریت پاڼه -->
        <div class="page" id="videos-page">
            <div class="related-videos">
                <div class="section-title">
                    <span data-lang-key="manage_videos">د ویډیوګانو مدیریت</span>
                    <button class="admin-btn" onclick="showPage('profile-page')">
                        <i class="fas fa-arrow-left"></i> <span data-lang-key="back">بیرته</span>
                    </button>
                </div>

                <div id="videos-list">
                    <!-- دلته ویډیوګانې به په JavaScript کې اضافه شي -->
                </div>
            </div>
        </div>

        <!-- د اډمین جوړولو پاڼه -->
        <div class="page" id="create-admin-page">
            <div class="related-videos">
                <div class="section-title">
                    <span data-lang-key="create_admin">اډمین جوړول</span>
                    <button class="admin-btn" onclick="showPage('profile-page')">
                        <i class="fas fa-arrow-left"></i> <span data-lang-key="back">بیرته</span>
                    </button>
                </div>

                <div class="form-group">
                    <label for="admin-email" data-lang-key="admin_email_label">د اډمین برېښنالیک</label>
                    <input type="email" id="admin-email" data-lang-key="admin_email_placeholder">
                </div>

                <div class="form-group">
                    <label data-lang-key="admin_permissions">د اډمین اجازې</label>
                    <div style="margin-top: 10px;">
                        <label><input type="checkbox" id="can-upload"> <span data-lang-key="can_upload">ویډیو اپلوډ کول</span></label><br>
                        <label><input type="checkbox" id="can-block"> <span data-lang-key="can_block">کاروونکي بلاک کول</span></label><br>
                        <label><input type="checkbox" id="can-delete"> <span data-lang-key="can_delete">ویډیو ډیلیټ کول</span></label><br>
                        <label><input type="checkbox" id="full-admin"> <span data-lang-key="full_admin">بشپړ اډمین</span></label>
                    </div>
                </div>

                <button class="admin-btn" onclick="createCustomAdmin()" style="background: var(--gradient);">
                    <i class="fas fa-user-shield"></i> <span data-lang-key="create">جوړول</span>
                </button>
            </div>
        </div>
    </div>

    <!-- تب بار -->
    <div class="tab-bar">
        <a href="#" class="tab-btn active" onclick="showPage('home-page')">
            <i class="fas fa-home"></i>
            <span data-lang-key="home">کور</span>
        </a>
        <a href="#" class="tab-btn" onclick="showPage('explore-page')">
            <i class="fas fa-compass"></i>
            <span data-lang-key="explore">اکتشاف</span>
        </a>
        <a href="#" class="tab-btn" onclick="showPage('downloads-page')">
            <i class="fas fa-download"></i>
            <span data-lang-key="downloads">ډاونلوډونه</span>
        </a>
        <a href="#" class="tab-btn" onclick="showPage('profile-page')">
            <i class="fas fa-user"></i>
            <span data-lang-key="profile">پروفایل</span>
        </a>
    </div>

    <!-- د آر ډارک موډ تڼۍ -->
    <div class="theme-toggle" onclick="toggleDarkMode()">
        <i class="fas fa-moon" id="theme-toggle-icon"></i>
    </div>

    <!-- لودر -->
    <div class="loader" id="loader">
        <div class="loader-content">
            <div style="margin-bottom: 15px;">
                <i class="fas fa-spinner fa-spin" style="font-size: 30px; color: var(--primary-color);"></i>
            </div>
            <span id="loader-text" data-lang-key="loading_video">ویډیو پلی کېږي...</span>
        </div>
    </div>

    <!-- د فایر بیز SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>

    <script>
        // د فایر بیز تنظیمات
        const firebaseConfig = {
            apiKey: "AIzaSyDzWtVoR3UXOYo6zBP21zWVflvQKIM3R04",
            authDomain: "afghan-flix.firebaseapp.com",
            projectId: "afghan-flix",
            storageBucket: "afghan-flix.appspot.com",
            messagingSenderId: "705875266433",
            appId: "1:705875266433:web:3a8f5d8f8d8f8d8f8d8f8"
        };

        // فایر بیز پیلول
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // د ژبې ډیټا
        const translations = {
            "ps": {
                "app_title": "Afghan Flix",
                "search_placeholder": "په Afghan Flix کې لټون...",
                "like": "لایک",
                "save": "خوندي",
                "download": "ډاونلوډ",
                "share": "شریکول",
                "views": "لیدنې",
                "days_ago": "2 ورځې وړاندې",
                "video_desc": "د پښتو یوه ښکلې سندره چې د زړه غږ دی.",
                "related_videos": "اړونده ویډیوګانې",
                "see_all": "ټولې وګورئ",
                "upload_video_title": "نوی ویډیو اپلوډ کړئ",
                "video_title_label": "د ویډیو عنوان",
                "video_title_placeholder": "د ویډیو عنوان ولیکئ",
                "description_label": "تفصیل",
                "description_placeholder": "د ویډیو په اړه لنډ معلومات ولیکئ",
                "category_label": "کټګوري",
                "documentary": "مستند",
                "history": "تاریخ",
                "culture": "کلتور",
                "music": "موسیقي",
                "video_file_label": "ویډیو فایل",
                "thumbnail_label": "د ویډیو تصویر",
                "upload": "اپلوډ کړئ",
                "settings_title": "ستاسو تنظیمات",
                "dark_mode": "د آر ډارک موډ",
                "change_language": "ژبه بدلول",
                "manage_storage": "د ذخیرې مدیریت",
                "admin_controls_title": "اډمین کنټرولونه",
                "manage_users": "د کارونکو مدیریت",
                "manage_videos": "د ویډیوګانو مدیریت",
                "create_admin": "اډمین جوړول",
                "other_options": "نور اختیارات",
                "help": "مرسته او پوښتنې",
                "contact_us": "زموږ سره اړیکه",
                "logout": "وتل",
                "login_title": "ننوتل",
                "email_label": "برېښنالیک",
                "email_placeholder": "ستاسو برېښنالیک ولیکئ",
                "password_label": "پاسورډ",
                "password_placeholder": "ستاسو پاسورډ ولیکئ",
                "login": "ننوتل",
                "create_account_link": "نوی حساب جوړول؟",
                "register_title": "نوی حساب جوړول",
                "name_label": "نوم",
                "name_placeholder": "ستاسو نوم ولیکئ",
                "confirm_password_label": "پاسورډ تایید کړئ",
                "confirm_password_placeholder": "پاسورډ بیا ولیکئ",
                "register": "حساب جوړول",
                "already_have_account": "دمخه حساب لرئ؟ ننوتل",
                "back": "بیرته",
                "admin_email_label": "د اډمین برېښنالیک",
                "admin_email_placeholder": "د اډمین برېښنالیک ولیکئ",
                "admin_permissions": "د اډمین اجازې",
                "can_upload": "ویډیو اپلوډ کول",
                "can_block": "کاروونکي بلاک کول",
                "can_delete": "ویډیو ډیلیټ کول",
                "full_admin": "بشپړ اډمین",
                "create": "جوړول",
                "home": "کور",
                "explore": "اکتشاف",
                "downloads": "ډاونلوډونه",
                "profile": "پروفایل",
                "loading_video": "ویډیو پلی کېږي...",
                "only_admin_access": "یوازې اډمین کولی شي دا کار وکړي!",
                "confirm_remove_admin": "آیا تاسو ډاډه یاست چې غواړئ دا اډمین لرې کړئ؟",
                "admin_removed": "اډمین په بریالیتوب سره لرې شو!",
                "remove_admin_error": "د اډمین لرې کولو پر مهال ستونزه",
                "enter_admin_email": "مهرباني وکړئ د اډمین برېښنالیک ولیکئ!",
                "user_not_found": "کارونکی ونه موندل شو!",
                "creating_admin": "اډمین جوړیږي...",
                "admin_created": "اډمین په بریالیتوب سره جوړ شو!",
                "create_admin_error": "د اډمین جوړولو پر مهال ستونزه",
                "confirm_delete_video": "آیا تاسو ډاډه یاست چې غواړئ دا ویډیو ړنګه کړئ؟",
                "video_deleted": "ویډیو په بریالیتوب سره ړنګه شوه!",
                "delete_video_error": "د ویډیو ړنګولو پر مهال ستونزه",
                "fetching_users": "کارونکي راټولېږي...",
                "fetch_users_error": "د کارونکو لیست ترلاسه کولو کې ستونزه",
                "fetching_videos": "ویډیوګانې راټولېږي...",
                "fetch_videos_error": "د ویډیوګانو لیست ترلاسه کولو کې ستونزه",
                "confirm_block_user": "آیا تاسو ډاډه یاست چې غواړئ دا کارونکی بلاک کړئ؟",
                "user_blocked": "کارونکی په بریالیتوب سره بلاک شو!",
                "block_error": "د بلاک کولو پر مهال ستونزه",
                "only_admin_upload": "یوازې اډمین کولی شي ویډیو اپلوډ کړي!",
                "fill_required_fields": "مهرباني وکړئ ټول اړین معلومات ولیکئ!",
                "login_required": "د اپلوډ لپاره لومړی ننوتل ضروري دی!",
                "uploading_video": "ویډیو اپلوډیږي...",
                "upload_success": "ستاسو ویډیو په بریالیتوب سره اپلوډ شو!",
                "upload_error": "د اپلوډ پر مهال ستونزه",
                "password_mismatch": "پاسورډونه مطابقت نلري!",
                "logging_in": "ننوتل کېږي...",
                "login_error": "د ننوتلو پر مهال ستونزه",
                "creating_account": "حساب جوړیږي...",
                "register_error": "د ثبتولو پر مهال ستونزه",
                "confirm_logout": "آیا تاسو ډاډه یاست چې غواړئ ووځئ؟",
                "storage_management_coming_soon": "د ذخیرې مدیریت به راتلونکي کې اضافه شي.",
                "contact_for_help": "د مرستې لپاره زموږ سره په haqanijan70@gmail.com برېښنالیک وکړئ.",
                "block": "بلاک",
                "delete": "ړنګول",
                "remove_admin": "اډمین لرې کول",
                "skip_backward": "10 ثانیې شاته",
                "skip_forward": "10 ثانیې مخکې",
                "fullscreen": "بشپړ سکرین"
            },
            "fa": {
                "app_title": "افغان فلیکس",
                "search_placeholder": "جستجو در Afghan Flix...",
                "like": "لایک",
                "save": "ذخیره",
                "download": "دانلود",
                "share": "اشتراک",
                "views": "بازدید",
                "days_ago": "۲ روز پیش",
                "video_desc": "یک آهنگ زیبای پشتو که صدای دل است.",
                "related_videos": "ویدیوهای مرتبط",
                "see_all": "مشاهده همه",
                "upload_video_title": "آپلود ویدیوی جدید",
                "video_title_label": "عنوان ویدیو",
                "video_title_placeholder": "عنوان ویدیو را بنویسید",
                "description_label": "توضیحات",
                "description_placeholder": "توضیحات مختصر درباره ویدیو بنویسید",
                "category_label": "دسته‌بندی",
                "documentary": "مستند",
                "history": "تاریخ",
                "culture": "فرهنگ",
                "music": "موسیقی",
                "video_file_label": "فایل ویدیویی",
                "thumbnail_label": "تصویر ویدیویی",
                "upload": "آپلود کنید",
                "settings_title": "تنظیمات شما",
                "dark_mode": "حالت تاریک",
                "change_language": "تغییر زبان",
                "manage_storage": "مدیریت ذخیره‌سازی",
                "admin_controls_title": "کنترل‌های ادمین",
                "manage_users": "مدیریت کاربران",
                "manage_videos": "مدیریت ویدیوها",
                "create_admin": "ایجاد ادمین",
                "other_options": "گزینه‌های دیگر",
                "help": "کمک و سوالات",
                "contact_us": "تماس با ما",
                "logout": "خروج",
                "login_title": "ورود",
                "email_label": "ایمیل",
                "email_placeholder": "ایمیل خود را بنویسید",
                "password_label": "رمز عبور",
                "password_placeholder": "رمز عبور خود را بنویسید",
                "login": "ورود",
                "create_account_link": "ایجاد حساب جدید؟",
                "register_title": "ایجاد حساب جدید",
                "name_label": "نام",
                "name_placeholder": "نام خود را بنویسید",
                "confirm_password_label": "تأیید رمز عبور",
                "confirm_password_placeholder": "رمز عبور را دوباره بنویسید",
                "register": "ایجاد حساب",
                "already_have_account": "قبلاً حساب دارید؟ ورود",
                "back": "بازگشت",
                "admin_email_label": "ایمیل ادمین",
                "admin_email_placeholder": "ایمیل ادمین را بنویسید",
                "admin_permissions": "اجازه‌های ادمین",
                "can_upload": "آپلود ویدیو",
                "can_block": "بلاک کردن کاربران",
                "can_delete": "حذف ویدیو",
                "full_admin": "ادمین کامل",
                "create": "ایجاد",
                "home": "خانه",
                "explore": "کاوش",
                "downloads": "دانلودها",
                "profile": "پروفایل",
                "loading_video": "ویدیو در حال پخش است...",
                "only_admin_access": "فقط ادمین می‌تواند این کار را انجام دهد!",
                "confirm_remove_admin": "آیا مطمئن هستید که می‌خواهید این ادمین را حذف کنید؟",
                "admin_removed": "ادمین با موفقیت حذف شد!",
                "remove_admin_error": "خطا در حذف ادمین",
                "enter_admin_email": "لطفاً ایمیل ادمین را وارد کنید!",
                "user_not_found": "کاربر یافت نشد!",
                "creating_admin": "در حال ایجاد ادمین...",
                "admin_created": "ادمین با موفقیت ایجاد شد!",
                "create_admin_error": "خطا در ایجاد ادمین",
                "confirm_delete_video": "آیا مطمئن هستید که می‌خواهید این ویدیو را حذف کنید؟",
                "video_deleted": "ویدیو با موفقیت حذف شد!",
                "delete_video_error": "خطا در حذف ویدیو",
                "fetching_users": "در حال جمع‌آوری کاربران...",
                "fetch_users_error": "خطا در دریافت لیست کاربران",
                "fetching_videos": "در حال جمع‌آوری ویدیوها...",
                "fetch_videos_error": "خطا در دریافت لیست ویدیوها",
                "confirm_block_user": "آیا مطمئن هستید که می‌خواهید این کاربر را بلاک کنید؟",
                "user_blocked": "کاربر با موفقیت بلاک شد!",
                "block_error": "خطا در بلاک کردن",
                "only_admin_upload": "فقط ادمین می‌تواند ویدیو آپلود کند!",
                "fill_required_fields": "لطفاً تمام اطلاعات مورد نیاز را پر کنید!",
                "login_required": "برای آپلود ابتدا باید وارد شوید!",
                "uploading_video": "ویدیو در حال آپلود است...",
                "upload_success": "ویدیوی شما با موفقیت آپلود شد!",
                "upload_error": "خطا در آپلود",
                "password_mismatch": "رمزهای عبور مطابقت ندارند!",
                "logging_in": "در حال ورود...",
                "login_error": "خطا در ورود",
                "creating_account": "در حال ایجاد حساب...",
                "register_error": "خطا در ثبت‌نام",
                "confirm_logout": "آیا مطمئن هستید که می‌خواهید خارج شوید؟",
                "storage_management_coming_soon": "مدیریت ذخیره‌سازی به زودی اضافه خواهد شد.",
                "contact_for_help": "برای کمک با ما از طریق haqanijan70@gmail.com تماس بگیرید.",
                "block": "بلاک",
                "delete": "حذف",
                "remove_admin": "حذف ادمین",
                "skip_backward": "10 ثانیه عقب",
                "skip_forward": "10 ثانیه جلو",
                "fullscreen": "تمام صفحه"
            },
            "en": {
                "app_title": "Afghan Flix",
                "search_placeholder": "Search in Afghan Flix...",
                "like": "Like",
                "save": "Save",
                "download": "Download",
                "share": "Share",
                "views": "Views",
                "days_ago": "2 days ago",
                "video_desc": "A beautiful Pashto song that speaks to the heart.",
                "related_videos": "Related Videos",
                "see_all": "See All",
                "upload_video_title": "Upload New Video",
                "video_title_label": "Video Title",
                "video_title_placeholder": "Enter video title",
                "description_label": "Description",
                "description_placeholder": "Enter a short description of the video",
                "category_label": "Category",
                "documentary": "Documentary",
                "history": "History",
                "culture": "Culture",
                "music": "Music",
                "video_file_label": "Video File",
                "thumbnail_label": "Video Thumbnail",
                "upload": "Upload",
                "settings_title": "Your Settings",
                "dark_mode": "Dark Mode",
                "change_language": "Change Language",
                "manage_storage": "Manage Storage",
                "admin_controls_title": "Admin Controls",
                "manage_users": "Manage Users",
                "manage_videos": "Manage Videos",
                "create_admin": "Create Admin",
                "other_options": "Other Options",
                "help": "Help & FAQs",
                "contact_us": "Contact Us",
                "logout": "Logout",
                "login_title": "Login",
                "email_label": "Email",
                "email_placeholder": "Enter your email",
                "password_label": "Password",
                "password_placeholder": "Enter your password",
                "login": "Login",
                "create_account_link": "Create a new account?",
                "register_title": "Create New Account",
                "name_label": "Name",
                "name_placeholder": "Enter your name",
                "confirm_password_label": "Confirm Password",
                "confirm_password_placeholder": "Re-enter your password",
                "register": "Create Account",
                "already_have_account": "Already have an account? Login",
                "back": "Back",
                "admin_email_label": "Admin Email",
                "admin_email_placeholder": "Enter admin email",
                "admin_permissions": "Admin Permissions",
                "can_upload": "Upload Videos",
                "can_block": "Block Users",
                "can_delete": "Delete Videos",
                "full_admin": "Full Admin",
                "create": "Create",
                "home": "Home",
                "explore": "Explore",
                "downloads": "Downloads",
                "profile": "Profile",
                "loading_video": "Video is playing...",
                "only_admin_access": "Only admins can perform this action!",
                "confirm_remove_admin": "Are you sure you want to remove this admin?",
                "admin_removed": "Admin removed successfully!",
                "remove_admin_error": "Error removing admin",
                "enter_admin_email": "Please enter the admin's email!",
                "user_not_found": "User not found!",
                "creating_admin": "Creating admin...",
                "admin_created": "Admin created successfully!",
                "create_admin_error": "Error creating admin",
                "confirm_delete_video": "Are you sure you want to delete this video?",
                "video_deleted": "Video deleted successfully!",
                "delete_video_error": "Error deleting video",
                "fetching_users": "Fetching users...",
                "fetch_users_error": "Error fetching users list",
                "fetching_videos": "Fetching videos...",
                "fetch_videos_error": "Error fetching videos list",
                "confirm_block_user": "Are you sure you want to block this user?",
                "user_blocked": "User blocked successfully!",
                "block_error": "Error blocking user",
                "only_admin_upload": "Only admins can upload videos!",
                "fill_required_fields": "Please fill all required fields!",
                "login_required": "You must log in to upload!",
                "uploading_video": "Uploading video...",
                "upload_success": "Your video has been uploaded successfully!",
                "upload_error": "Error during upload",
                "password_mismatch": "Passwords do not match!",
                "logging_in": "Logging in...",
                "login_error": "Error during login",
                "creating_account": "Creating account...",
                "register_error": "Error during registration",
                "confirm_logout": "Are you sure you want to logout?",
                "storage_management_coming_soon": "Storage management will be added soon.",
                "contact_for_help": "For help, contact us at haqanijan70@gmail.com.",
                "block": "Block",
                "delete": "Delete",
                "remove_admin": "Remove Admin",
                "skip_backward": "10s Backward",
                "skip_forward": "10s Forward",
                "fullscreen": "Fullscreen"
            }
        };

        // د ژبې بدلولو فنکشن
        function changeLanguage() {
            const lang = document.getElementById('languageSelect').value;
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                element.textContent = translations[lang][key];
                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    element.placeholder = translations[lang][key];
                }
            });

            // د متن سمت تنظیم کول
            document.documentElement.setAttribute('lang', lang);
            document.documentElement.setAttribute('dir', lang === 'en' ? 'ltr' : 'rtl');
        }

        // د سرچ بار فعالولو فنکشن
        function toggleSearch() {
            const searchBar = document.getElementById('searchBar');
            searchBar.style.display = searchBar.style.display === 'block' ? 'none' : 'block';
            if (searchBar.style.display === 'block') {
                document.getElementById('searchInput').focus();
            }
        }

        // د آر ډارک موډ فعالولو فنکشن
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('theme-toggle-icon');
            icon.className = document.body.classList.contains('dark-mode') ? 'fas fa-sun' : 'fas fa-moon';
        }

        // د پاڼو بدلولو فنکشن
        // د پاڼو بدلولو فنکشن (ادامه)
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');

            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.tab-btn[onclick="showPage('${pageId}')"]`).classList.add('active');

            if (pageId === 'upload-page' && (!auth.currentUser || auth.currentUser.email !== 'haqanijan30@gmail.com')) {
                const lang = document.getElementById('languageSelect').value;
                alert(translations[lang]['only_admin_upload']);
                showPage('login-page');
                return;
            }

            if (pageId === 'home-page') {
                loadVideo('https://archive.org/download/afghan-flix-videos/pashto-song.mp4', 'Pashto Song - Da Zra Qarara Rasha', translations[lang]['video_desc']);
            }
        }

        // د کارونکي حالت چیک کولو فنکشن
        function isAdmin(user) {
            return user && user.email === 'haqanijan30@gmail.com';
        }

        // د ویډیو اپلوډ فنکشن
        async function uploadVideo() {
            const title = document.getElementById('video-title-input').value;
            const description = document.getElementById('video-desc-input').value;
            const categoryId = document.getElementById('video-category').value;
            const videoFile = document.getElementById('video-file').files[0];
            const thumbnailFile = document.getElementById('video-thumbnail').files[0];

            const lang = document.getElementById('languageSelect').value;

            if (!title || !description || !videoFile) {
                showUploadStatus(translations[lang]['fill_required_fields'], 'error');
                return;
            }

            if (!auth.currentUser) {
                showUploadStatus(translations[lang]['login_required'], 'error');
                showPage('login-page');
                return;
            }

            if (auth.currentUser.email !== 'haqanijan30@gmail.com') {
                showUploadStatus(translations[lang]['only_admin_upload'], 'error');
                return;
            }

            document.getElementById('loader').style.display = 'flex';
            document.getElementById('loader-text').textContent = translations[lang]['uploading_video'];

            try {
                const videoRef = storage.ref(`videos/${auth.currentUser.uid}/${videoFile.name}`);
                await videoRef.put(videoFile);
                const videoUrl = await videoRef.getDownloadURL();

                let thumbnailUrl = 'https://archive.org/download/afghan-flix-thumbnails/default-thumbnail.jpg';
                if (thumbnailFile) {
                    const thumbRef = storage.ref(`thumbnails/${auth.currentUser.uid}/${thumbnailFile.name}`);
                    await thumbRef.put(thumbnailFile);
                    thumbnailUrl = await thumbRef.getDownloadURL();
                }

                const videoData = {
                    title: title,
                    description: description,
                    categoryId: categoryId,
                    videoUrl: videoUrl,
                    thumbnailUrl: thumbnailUrl,
                    uploader: auth.currentUser.uid,
                    uploaderName: auth.currentUser.displayName || auth.currentUser.email,
                    uploadDate: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'uploaded',
                    views: 0,
                    likes: 0
                };

                await db.collection('videos').add(videoData);

                document.getElementById('loader').style.display = 'none';
                showUploadStatus(translations[lang]['upload_success'], 'success');

                document.getElementById('video-title-input').value = '';
                document.getElementById('video-desc-input').value = '';
                document.getElementById('video-file').value = '';
                document.getElementById('video-thumbnail').value = '';

            } catch (error) {
                document.getElementById('loader').style.display = 'none';
                showUploadStatus(`${translations[lang]['upload_error']}: ${error.message}`, 'error');
            }
        }

        // د اپلوډ حالت ښودلو فنکشن
        function showUploadStatus(message, type) {
            const status = document.getElementById('upload-status');
            status.textContent = message;
            status.style.display = 'block';
            status.className = `upload-status upload-${type}`;
        }

        // د ننوتلو فنکشن
        async function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const lang = document.getElementById('languageSelect').value;

            if (!email || !password) {
                alert(translations[lang]['fill_required_fields']);
                return;
            }

            document.getElementById('loader').style.display = 'flex';
            document.getElementById('loader-text').textContent = translations[lang]['logging_in'];

            try {
                await auth.signInWithEmailAndPassword(email, password);
                document.getElementById('loader').style.display = 'none';
                showPage('profile-page');
            } catch (error) {
                document.getElementById('loader').style.display = 'none';
                alert(`${translations[lang]['login_error']}: ${error.message}`);
            }
        }

        // د ثبتولو فنکشن
        async function register() {
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm').value;
            const lang = document.getElementById('languageSelect').value;

            if (!name || !email || !password || !confirmPassword) {
                alert(translations[lang]['fill_required_fields']);
                return;
            }

            if (password !== confirmPassword) {
                alert(translations[lang]['password_mismatch']);
                return;
            }

            document.getElementById('loader').style.display = 'flex';
            document.getElementById('loader-text').textContent = translations[lang]['creating_account'];

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await userCredential.user.updateProfile({ displayName: name });
                await db.collection('users').doc(userCredential.user.uid).set({
                    name: name,
                    email: email,
                    permissions: { canUpload: false, canBlock: false, canDelete: false, isFullAdmin: false },
                    blocked: false
                });
                document.getElementById('loader').style.display = 'none';
                showPage('profile-page');
            } catch (error) {
                document.getElementById('loader').style.display = 'none';
                alert(`${translations[lang]['register_error']}: ${error.message}`);
            }
        }

        // د وتلو فنکشن
        function logout() {
            const lang = document.getElementById('languageSelect').value;
            if (confirm(translations[lang]['confirm_logout'])) {
                auth.signOut();
                showPage('login-page');
            }
        }

        // د کارونکو مدیریت ښودلو فنکشن
        async function showUserManagement() {
            const lang = document.getElementById('languageSelect').value;
            if (!isAdmin(auth.currentUser)) {
                alert(translations[lang]['only_admin_access']);
                return;
            }

            document.getElementById('loader').style.display = 'flex';
            document.getElementById('loader-text').textContent = translations[lang]['fetching_users'];

            try {
                const usersSnapshot = await db.collection('users').get();
                const usersList = document.getElementById('users-list');
                usersList.innerHTML = '';

                usersSnapshot.forEach(doc => {
                    const user = doc.data();
                    const userId = doc.id;
                    const blocked = user.blocked ? ' (Blocked)' : '';
                    const userDiv = document.createElement('div');
                    userDiv.className = 'video-item';
                    userDiv.innerHTML = `
                        <div class="video-item-info">
                            <div class="video-item-title">${user.name} (${user.email})${blocked}</div>
                            <div class="video-item-meta">
                                <button class="admin-btn" onclick="blockUser('${userId}')">
                                    <i class="fas fa-ban"></i> ${translations[lang]['block']}
                                </button>
                                <button class="admin-btn" onclick="removeAdmin('${userId}')">
                                    <i class="fas fa-user-times"></i> ${translations[lang]['remove_admin']}
                                </button>
                            </div>
                        </div>
                    `;
                    usersList.appendChild(userDiv);
                });

                document.getElementById('loader').style.display = 'none';
                showPage('users-page');
            } catch (error) {
                document.getElementById('loader').style.display = 'none';
                alert(`${translations[lang]['fetch_users_error']}: ${error.message}`);
            }
        }

        // د ویډیو مدیریت ښودلو فنکشن
        async function showVideoManagement() {
            const lang = document.getElementById('languageSelect').value;
            const userDoc = await db.collection('users').doc(auth.currentUser.uid).get();
            const userData = userDoc.data();

            if (!isAdmin(auth.currentUser) && !(userData.permissions && userData.permissions.canDelete)) {
                alert(translations[lang]['only_admin_access']);
                return;
            }

            document.getElementById('loader').style.display = 'flex';
            document.getElementById('loader-text').textContent = translations[lang]['fetching_videos'];

            try {
                const videosSnapshot = await db.collection('videos').get();
                const videosList = document.getElementById('videos-list');
                videosList.innerHTML = '';

                videosSnapshot.forEach(doc => {
                    const video = doc.data();
                    const videoId = doc.id;
                    const videoDiv = document.createElement('div');
                    videoDiv.className = 'video-item';
                    videoDiv.innerHTML = `
                        <div class="video-thumb">
                            <img src="${video.thumbnailUrl}" alt="Video Thumbnail">
                            <span class="duration">10:25</span>
                        </div>
                        <div class="video-item-info">
                            <div class="video-item-title">${video.title}</div>
                            <div class="video-item-meta">
                                <button class="admin-btn" onclick="deleteVideo('${videoId}')">
                                    <i class="fas fa-trash"></i> ${translations[lang]['delete']}
                                </button>
                            </div>
                        </div>
                    `;
                    videosList.appendChild(videoDiv);
                });

                document.getElementById('loader').style.display = 'none';
                showPage('videos-page');
            } catch (error) {
                document.getElementById('loader').style.display = 'none';
                alert(`${translations[lang]['fetch_videos_error']}: ${error.message}`);
            }
        }

        // د کارونکي بلاک کولو فنکشن
        async function blockUser(userId) {
            const lang = document.getElementById('languageSelect').value;
            if (!isAdmin(auth.currentUser)) {
                alert(translations[lang]['only_admin_access']);
                return;
            }

            if (confirm(translations[lang]['confirm_block_user'])) {
                try {
                    await db.collection('users').doc(userId).update({
                        blocked: true
                    });
                    alert(translations[lang]['user_blocked']);
                    showUserManagement();
                } catch (error) {
                    alert(`${translations[lang]['block_error']}: ${error.message}`);
                }
            }
        }

        // د اډمین لرې کولو فنکشن
        async function removeAdmin(userId) {
            const lang = document.getElementById('languageSelect').value;
            if (!isAdmin(auth.currentUser)) {
                alert(translations[lang]['only_admin_access']);
                return;
            }

            if (confirm(translations[lang]['confirm_remove_admin'])) {
                try {
                    await db.collection('users').doc(userId).update({
                        'permissions.canUpload': false,
                        'permissions.canBlock': false,
                        'permissions.canDelete': false,
                        'permissions.isFullAdmin': false
                    });
                    alert(translations[lang]['admin_removed']);
                    showUserManagement();
                } catch (error) {
                    alert(`${translations[lang]['remove_admin_error']}: ${error.message}`);
                }
            }
        }

        // د ویډیو ړنګولو فنکشن
        async function deleteVideo(videoId) {
            const lang = document.getElementById('languageSelect').value;
            const userDoc = await db.collection('users').doc(auth.currentUser.uid).get();
            const userData = userDoc.data();

            if (!isAdmin(auth.currentUser) && !(userData.permissions && userData.permissions.canDelete)) {
                alert(translations[lang]['only_admin_access']);
                return;
            }

            if (confirm(translations[lang]['confirm_delete_video'])) {
                try {
                    await db.collection('videos').doc(videoId).delete();
                    alert(translations[lang]['video_deleted']);
                    showVideoManagement();
                } catch (error) {
                    alert(`${translations[lang]['delete_video_error']}: ${error.message}`);
                }
            }
        }

        // د اډمین جوړولو فنکشن
        async function createCustomAdmin() {
            const lang = document.getElementById('languageSelect').value;
            if (!isAdmin(auth.currentUser)) {
                alert(translations[lang]['only_admin_access']);
                return;
            }

            const adminEmail = document.getElementById('admin-email').value;
            const canUpload = document.getElementById('can-upload').checked;
            const canBlock = document.getElementById('can-block').checked;
            const canDelete = document.getElementById('can-delete').checked;
            const fullAdmin = document.getElementById('full-admin').checked;

            if (!adminEmail) {
                alert(translations[lang]['enter_admin_email']);
                return;
            }

            document.getElementById('loader').style.display = 'flex';
            document.getElementById('loader-text').textContent = translations[lang]['creating_admin'];

            try {
                const userSnapshot = await db.collection('users').where('email', '==', adminEmail).get();
                if (userSnapshot.empty) {
                    document.getElementById('loader').style.display = 'none';
                    alert(translations[lang]['user_not_found']);
                    return;
                }

                const userDoc = userSnapshot.docs[0];
                await db.collection('users').doc(userDoc.id).update({
                    permissions: {
                        canUpload: fullAdmin || canUpload,
                        canBlock: fullAdmin || canBlock,
                        canDelete: fullAdmin || canDelete,
                        isFullAdmin: fullAdmin
                    }
                });

                document.getElementById('loader').style.display = 'none';
                alert(translations[lang]['admin_created']);
                showPage('profile-page');
            } catch (error) {
                document.getElementById('loader').style.display = 'none';
                alert(`${translations[lang]['create_admin_error']}: ${error.message}`);
            }
        }

        // د اډمین کنټرولونو ښودلو فنکشن
        function showCreateAdmin() {
            const lang = document.getElementById('languageSelect').value;
            if (!isAdmin(auth.currentUser)) {
                alert(translations[lang]['only_admin_access']);
                return;
            }
            showPage('create-admin-page');
        }

        // د مرستې ښودلو فنکشن
        function showHelp() {
            const lang = document.getElementById('languageSelect').value;
            alert(translations[lang]['contact_for_help']);
        }

        // د اړیکې فنکشن
        function contactUs() {
            const lang = document.getElementById('languageSelect').value;
            alert(translations[lang]['contact_for_help']);
        }

        // د ذخیرې مدیریت فنکشن
        function manageStorage() {
            const lang = document.getElementById('languageSelect').value;
            alert(translations[lang]['storage_management_coming_soon']);
        }

        // د ویډیو پلیئر تنظیم کول
        const videoPlayer = document.getElementById('custom-video-player');
        const videoSource = document.getElementById('video-source');
        const skipBackwardBtn = document.getElementById('skip-backward');
        const skipForwardBtn = document.getElementById('skip-forward');
        const qualitySelect = document.getElementById('quality-select');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const volumeControl = document.getElementById('volume-control');

        // د ویډیو لوډ کولو فنکشن
        function loadVideo(videoUrl, title, desc) {
            videoSource.src = videoUrl;
            videoPlayer.load();
            videoPlayer.play();
            document.getElementById('video-title').textContent = title;
            document.getElementById('video-desc').textContent = desc;
            document.getElementById('loader').style.display = 'none';
        }

        // د شاته او مخکې تڼۍ
        skipBackwardBtn.addEventListener('click', () => {
            videoPlayer.currentTime -= 10;
        });

        skipForwardBtn.addEventListener('click', () => {
            videoPlayer.currentTime += 10;
        });

        // د کیفیت انتخاب
        qualitySelect.addEventListener('change', (e) => {
            const quality = e.target.value;
            const currentTime = videoPlayer.currentTime;
            const wasPlaying = !videoPlayer.paused;

            // د کیفیت پر بنسټ د ویډیو URL بدلول (دا یو مثال دی، تاسو باید د مختلف کیفیتونو لپاره URLs ولرئ)
            const baseUrl = videoSource.src.split('/').slice(0, -1).join('/');
            videoSource.src = `${baseUrl}/${quality}.mp4`;
            videoPlayer.load();
            videoPlayer.currentTime = currentTime;
            if (wasPlaying) videoPlayer.play();
        });

        // بشپړ سکرین تڼۍ
        fullscreenBtn.addEventListener('click', () => {
            if (videoPlayer.requestFullscreen) {
                videoPlayer.requestFullscreen();
            } else if (videoPlayer.webkitRequestFullscreen) {
                videoPlayer.webkitRequestFullscreen();
            }
        });

        // د اواز کنټرول
        volumeControl.addEventListener('input', (e) => {
            videoPlayer.volume = e.target.value;
        });

        // د کارونکي حالت تازه کولو فنکشن
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                document.getElementById('user-name').textContent = user.displayName || user.email.split('@')[0];
                document.getElementById('user-email').textContent = user.email;
                if (user.photoURL) {
                    document.getElementById('profile-image').src = user.photoURL;
                }

                if (isAdmin(user)) {
                    document.getElementById('admin-controls').style.display = 'block';
                } else {
                    document.getElementById('admin-controls').style.display = 'none';
                }

                showPage('profile-page');
            } else {
                showPage('login-page');
                document.getElementById('admin-controls').style.display = 'none';
            }
        });

        // د لومړنۍ ژبې تنظیم کول
        document.addEventListener('DOMContentLoaded', () => {
            changeLanguage();
            loadVideo('https://archive.org/download/afghan-flix-videos/pashto-song.mp4', 'Pashto Song - Da Zra Qarara Rasha', translations['ps']['video_desc']);
        });
    </script>
</body>
</html>
